<h1 id="node-js-sdk">Node.js SDK</h1>

<p>Analytics sdk integration instructions for node.js based web applications.</p>

<h2 id="first-steps">First Steps</h2>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Require example</span>
<span class="kd">var</span> <span class="nx">TG</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="err">“</span><span class="p">.</span><span class="o">/</span><span class="nx">TGASDK</span><span class="o">&lt;</span><span class="nx">gamename</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">js</span><span class="err">”</span><span class="p">);</span>
</code></pre>
<ol>
<li>TeacherGaming will send you a <code class="prettyprint">TGASDK&lt;gamename&gt;.zip</code> archive.</li>
<li>Copy the following files to their respective folders:

<ul>
<li>tgnodejs-client.min.js <client side></li>
<li>tgnodejs.min.css <stylesheet for the dialog></li>
<li>TGASDK<gamename>.js <server side></li>
</ul></li>
<li>Link/require each file wherever you are going to use them</li>
<li>Install the cookies node module with following command: 

<ul>
<li><code class="prettyprint">npm install cookies</code></li>
<li>You also need to require the cookies node module in the same file where your /tgapi route will exist</li>
</ul></li>
</ol>

<h2 id="student-login-logout">Student Login/Logout</h2>

<p>As TeacherGaming Desk analytics (TGA) requires the game to send a Class ID and a Student ID for each user playing the game to assign data for right user, users need to login before data can be sent.</p>

<p>Logging in can be done through the TeacherGaming App (TG App) or in game. If users authenticate in game you will need to add a button which will open a login dialog.</p>

<h3 id="automatically-logging-in-with-tg-app">Automatically Logging in with TG App</h3>
<pre class="highlight plaintext"><code>Example: 

https://&lt;origin&gt;?classid=example&amp;studentid=example
</code></pre>
<p>Client side of the SDK handles the automatic login completely so you don’t need to do anything else except ensure that client side code has been required on client side. TG App will send Class ID and Student ID as url parameters.</p>

<h3 id="manual-login-logout">Manual Login/Logout</h3>

<p>Manual login is secondary option for students that didn’t login through TG App. Client side code has a login dialog. You need to create a button that calls the following function when clicked:</p>

<p><code class="prettyprint">TG.createDialog();</code></p>

<p>This will show up the dialog to user. It will show either login fields if user is not logged in or info page with logout button if user is logged in.</p>

<h4 id="validating-login-logout">Validating login/logout</h4>

<p>Server side of the SDK will validate login/logout and send it to TGA. You will however need to pass the login/logout parameters to the server side of the SDK through a route. You will also need to pass the response from the login/logout back to the client side inside the callback.</p>

<h4 id="route-example">Route Example</h4>

<p>Example is done in Meteor-framework.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">Router</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'tgapi'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cookies</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cookies</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>

    <span class="nx">TG</span><span class="p">[</span><span class="o">*</span><span class="nx">action</span> <span class="nx">parameter</span><span class="o">*</span><span class="p">](</span><span class="o">*</span><span class="nx">query</span> <span class="nx">parameters</span> <span class="nx">obj</span><span class="o">*</span><span class="p">,</span> <span class="nx">cookies</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// WRITEHEAD</span>
        <span class="c1">// SEND RESPONSE</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre>
<h4 id="cookies">Cookies</h4>
<pre class="highlight javascript tab-javascript"><code><span class="kd">var</span> <span class="nx">cookies</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cookies</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
</code></pre>
<p>This SDK uses cookies node module to store credentials. These cookies will expire in 48hrs. <em>To enable the cookies you need to create new cookies instance inside the tgapi/ and pass it to the functions. You need to pass the routes request and response to the cookies instance.</em></p>

<h4 id="client-side">Client side</h4>

<p>Client side will pass the Class ID and Student ID as url parameters to tgapi/ route which you will need to catch. </p>

<p>Client will send parameters from dialog to following url: 
<code class="prettyprint">&lt;origin&gt;/tgapi?action=login&amp;classid=&lt;classid&gt;&amp;studentid=&lt;studentid&gt;</code></p>

<h2 id="sending-events-client-only">Sending Events (client only)</h2>

<p>The events that have been defined in TGA website are generated to the SDK and can be used to send data from the game to TGA. </p>

<h3 id="sending-events-with-duration">Sending Events with Duration</h3>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Examples:</span>

<span class="c1">// Start:</span>
<span class="nx">TG</span><span class="p">.</span><span class="nx">exampleEvent</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>

<span class="c1">// Send:</span>
<span class="nx">TG</span><span class="p">.</span><span class="nx">exampleEvent</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">param1</span><span class="p">,</span> <span class="nx">param2</span><span class="p">);</span>
</code></pre>
<p>This is useful to start an event and send it to TeacherGaming Desk when it’s ready. Our SDK automatically counts time from beginning to end and appends duration to sent data. When sending the event you need to pass the needed parameters to the function, otherwise it will throw an error and no event will be sent.
To start the event, call <code class="prettyprint">TG.&lt;EventName&gt;.start()</code>
Now you can gather all needed data for the event. 
To send the event, call <code class="prettyprint">TG.&lt;EventName&gt;.send(*data parameters*)</code></p>

<h3 id="sending-events-without-duration">Sending Events without Duration</h3>

<p>If event is something which you cannot track duration of just call <code class="prettyprint">TG.&lt;EventName&gt;.send()</code> with the parameters.</p>

<h2 id="updating-state-client-only">Updating State (client only)</h2>

<p>See <a href="#updating-state2.4.">2.4. UPDATING STATE</a>.</p>

<p>Updating state can be done using the following function:
<code class="prettyprint">TG.updateState(“state”, detailed);</code></p>

<p>The detailed-parameter is a boolean. </p>

<p>If it is set to false, function sets the state showing below student name in teacher dashboard. It also resets detailed state showing below this state, if there was any.</p>

<p>If set to true, function sets the detailed state that shows below basic state</p>

<p>You can keep the state update calls in your game and don’t need to check if user is logged in to TGA, we will automatically check inside the function calls if player is currently authenticated to TGA and send the state update only if so.</p>

<h3 id="state-examples">State examples</h3>
<pre class="highlight javascript tab-javascript"><code><span class="nx">TG</span><span class="p">.</span><span class="nx">updateState</span><span class="p">(</span><span class="s2">"In Main Menu"</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="nx">TG</span><span class="p">.</span><span class="nx">updateState</span><span class="p">(</span><span class="s2">"In Settings Menu"</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="nx">TG</span><span class="p">.</span><span class="nx">updateState</span><span class="p">(</span><span class="s2">"Playing Singleplayer Game"</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">TG</span><span class="p">.</span><span class="nx">updateState</span><span class="p">(</span><span class="s2">"Tutorial Level 4"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="c1">// When game begun</span>
<span class="nx">TG</span><span class="p">.</span><span class="nx">updateState</span><span class="p">(</span><span class="s2">"Playing Multiplayer Game"</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="c1">// When round changed</span>
<span class="nx">TG</span><span class="p">.</span><span class="nx">updateState</span><span class="p">(</span><span class="s2">"Round 2"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>
<table>
<tr>
    <td width="20%"> <img src="images/integrations/unitycsharp/image5.png"/> </td>
    <td width="20%"> <img src="images/integrations/unitycsharp/image4.png"/> </td>
    <td width="20%"> <img src="images/integrations/unitycsharp/image2.png"/> </td>
    <td width="20%"> <img src="images/integrations/unitycsharp/image1.png"/> </td>
    <td width="20%"> <img src="images/integrations/unitycsharp/image3.png"/> </td>
</tr>
<tr>
    <td><small>Default state for logged-in student </small></td>
    <td><small>Student is in main menu </small></td>
    <td><small>Student is in settings menu</small></td>
    <td><small>Student is playing singleplayer game, Tutorial Level 4 has been passed for detailed state</small></td>
    <td><small>Student is playing multiplayer game, Round number is being passed to detailed state when round changes</small></td>
</tr>
</table>
