<h1 id="unity-c-sdk">Unity C# SDK</h1>

<h2 id="general">General</h2>

<p>This document describes the specifics of integrating TGA to your game using the TGA Unity C# SDK. For general integration information and links to other SDK documents see the general SDK instructions.</p>

<h3 id="requirements">Requirements</h3>

<p>Our current SDK requires Unity 4.0.0f7 or later. If you need an SDK for an earlier version of Unity please contact us.</p>

<h3 id="first-steps">First steps</h3>

<ul>
<li>TeacherGaming will send you a .unitypackage with the latest SDK and assets.</li>
<li>Import the package by selecting “Assets -&gt; Import package -&gt; Custom package” in Unity.</li>
<li>Attach the SDK script to a GameObject that is not deleted during the game. The script is located in “TGAGameSpecific/” folder and is named TGASDK<yourgamenamehere>.cs</li>
<li>Updating the SDK and assets can usually be done by simply importing new package and updated files will automatically be detected.

<ul>
<li>If you are having problems and would like to try a complete reimport of the SDK, you can delete the following directories &amp; files before importing the package

<ul>
<li>TGA</li>
<li>TGAGameSpecific</li>
<li>StreamingAssets/TGA</li>
<li>Plugins/Android/AndroidManifest.xml</li>
</ul></li>
<li>In older versions of the SDK you needed to manually attach the CreatubblesManager script to a GameObject. You no longer need to do this and should remove it if you have attached it previously.</li>
</ul></li>
</ul>

<h3 id="notes">Notes</h3>

<p>Your game specific SDK file is called TGASDK<yourgamenamehere>.cs. Class inside that file is called TGASDK<yourgamenamehere>. To improve readability, we have not added <yourgamenamehere> for each method call in this document, we are mentioning TGASDK and you should add your game name after each TGASDK call to make it correct.</p>

<h2 id="student-login">Student login</h2>

<p>Logging in can be done through the TeacherGaming app (Android only at the moment) or in game. If users authenticate in game you will need to add a menu where user can type in a classid and a studentid. Authentication must be done before data can be sent.</p>

<h3 id="automatically-logging-in-with-teachergaming-app">Automatically logging in with TeacherGaming App</h3>
<pre class="highlight csharp tab-csharp"><code><span class="c1">// Automatically logging in with TeacherGaming App</span>
<span class="c1">// Login status delegate &amp; event (in TGASDK.TGA)</span>
<span class="k">public</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">LoginStatusListener</span><span class="p">(</span><span class="kt">bool</span> <span class="n">isLoggedIn</span><span class="p">);</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">event</span> <span class="n">LoginStatusListener</span> <span class="n">OnLoginStatusChanged</span><span class="p">;</span>
</code></pre><pre class="highlight xml tab-xml"><code><span class="c">&lt;!-- Assets/Plugins/Android/AndroidManifest.xml --&gt;</span>
<span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span> <span class="na">package=</span><span class="s">"com.unity3d.player"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;application</span> <span class="na">android:icon=</span><span class="s">"@drawable/app_icon"</span> <span class="na">android:label=</span><span class="s">"@string/app_name"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">"com.unity3d.player.UnityPlayerActivity"</span>
              <span class="na">android:label=</span><span class="s">"@string/app_name"</span>
              <span class="na">android:configChanges=</span><span class="s">"fontScale|keyboard|keyboardHidden|locale|mnc|mcc|navigation|orientation|screenLayout|screenSize|smallestScreenSize|uiMode|touchscreen"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;intent-filter&gt;</span>
            <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.MAIN"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.LAUNCHER"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/intent-filter&gt;</span>
    <span class="nt">&lt;/activity&gt;</span>

    <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">"com.teachergaming.tga.TGAAndroidUriSchemeActivity"</span>
            <span class="na">android:label=</span><span class="s">"@string/app_name"</span>
            <span class="na">android:launchMode=</span><span class="s">"singleTop"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;intent-filter&gt;</span>
            <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.VIEW"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.DEFAULT"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.BROWSABLE"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;data</span> <span class="na">android:scheme=</span><span class="s">"YOUR.BUNDLEIDENTIFIER.HERE"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- REPLACE WITH YOUR GAME'S ANDROID APP BUNDLE IDENTIFIER --&gt;</span>
        <span class="nt">&lt;/intent-filter&gt;</span>
    <span class="nt">&lt;/activity&gt;</span>

    <span class="nt">&lt;receiver</span>
        <span class="na">android:name=</span><span class="s">"com.teachergaming.tgareceiver.TGABroadcastReceiver"</span>
        <span class="na">android:enabled=</span><span class="s">"true"</span>
        <span class="na">android:exported=</span><span class="s">"true"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;intent-filter&gt;</span>
            <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.teachergaming.com.TGAbroadcast"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/intent-filter&gt;</span>
    <span class="nt">&lt;/receiver&gt;</span>

  <span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span> 
</code></pre><pre class="highlight plaintext"><code>You can test automatic login using the following URI format
&lt;your bundle identifier&gt;://?classid=&lt;class id&gt;&amp;studentid=&lt;student id&gt;&amp;command=&lt;login/logout&gt;
</code></pre>
<p>Logging in via TeacherGaming App is automatically handled by the SDK. You can listen to the TGASDK.TGA.OnLoginStatusChanged C# event to get notified when the login status changes. The event gives you one boolean parameter that is true if a student logged in and false if the current student logged out. The event is implemented using the C# delegate &amp; event system.</p>

<p>You can use the TGASDK.TGA.LoggedInExternally() to check if the user logged in using the TeacherGaming App.</p>

<p>Note for Android! In future versions of TeacherGaming App we are moving to use URI schemes to forward the login parameters to games on Android, like we already do on iOS. For this to work you need to specify your app&rsquo;s bundle id for the com.teachergaming.tga.TGAAndroidUriSchemeActivity activity in the AndroidManifest.xml file in Assets/Plugins/Android.</p>

<p>On Android and iOS you can test the uri scheme login by creating a .html file with links according to the URI scheme and opening it in your device browser and clicking on the links.</p>

<p>On desktop platforms you should test the automatic login by giving the uri as a command line parameter when starting your game. See https://docs.google.com/document/d/1nEJ5EGwO6JxTTmJGixvxEcBb0VhpMN7sEfOjGHY4JkI/edit#heading=h.1u1ow8hobpr for details.</p>

<h3 id="built-in-login-menu">Built-in login menu</h3>
<pre class="highlight csharp tab-csharp"><code><span class="c1">// Built-in login menu</span>
<span class="c1">// Using the built-in login menu</span>

<span class="c1">// First check that not already logged in externally</span>
<span class="k">if</span> <span class="p">(!</span><span class="n">TGASDK</span><span class="p">.</span><span class="n">TGA</span><span class="p">.</span><span class="nf">LoggedInExternally</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// Then show the login UI</span>
    <span class="n">TGASDK</span><span class="p">.</span><span class="n">TGA</span><span class="p">.</span><span class="nf">CreateLoginPanel</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
<p>The TGA Unity C# SDK can create a ready made UI that has all the authentication functionality built in. See the code example on the right on how to use it.
A login dialog will be created that looks like this (without the blue background)</p>

<p><img src="/images/integrations/unitycsharp/image6.png" title="UnityCSharp Login Example" alt="UnityCSharp Login Example" /></p>

<p>This dialog will inform user if the login failed or succeeded. As with login via TeacherGaming App you can listen to the TGASDK.TGA.OnLoginStatusChanged event to get notified when the login status changes.</p>

<h3 id="handling-subscription-required">Handling subscription required</h3>

<p>You can define the compile time symbol TGA_SUBSCRIPTION_REQUIRED to make the login menu require a subscription. If the symbol is defined you cannot login if you don&rsquo;t have an active subscription and you cannot close the login menu without logging in. Pressing X in the top-right corner will quit the application by calling Application.Quit(). You can also supply your own function for quitting as a parameter for TGASDK.TGA.CreateLoginPanel() for example if you need to bypass your Monobehaviour.OnApplicationQuit handler that calls Application.CancelQuit.</p>

<p>When TGA_SUBSCRIPTION_REQUIRED is defined you should show the login window when the game app is started (main menu or equivalent).</p>

<h3 id="custom-login-menu">Custom login menu</h3>
<pre class="highlight csharp tab-csharp"><code><span class="c1">// Custom login menu</span>
<span class="c1">// Logging in from code</span>

<span class="c1">// Create new Auth object and start authentication</span>
<span class="n">TGASDK</span><span class="p">.</span><span class="n">TGA</span><span class="p">.</span><span class="n">TGAAuth</span> <span class="n">tgaAuth</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TGASDK</span><span class="p">.</span><span class="n">TGA</span><span class="p">.</span><span class="nf">TGAAuth</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">TGASDK</span><span class="p">.</span><span class="n">TGA</span><span class="p">.</span><span class="n">TGAAuth</span><span class="p">.</span><span class="nf">AuthUser</span><span class="p">(</span><span class="k">class</span><span class="nc">ID</span><span class="p">,</span> <span class="n">studentID</span><span class="p">));</span>

<span class="c1">// Wait for auth result</span>
<span class="k">yield</span> <span class="k">return</span> <span class="n">tgaAuth</span><span class="p">.</span><span class="n">authResult</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">tgaAuth</span><span class="p">.</span><span class="n">authResult</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">"true"</span><span class="p">))</span>
<span class="p">{</span>
    <span class="c1">// Authentication succeeded (classid &amp; studentid we’re correct)</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="c1">// Authentication failed (classid &amp; studentid we’re not correct)</span>
<span class="p">}</span>
</code></pre>
<p>Note: If a student has logged in externally (using TeacherGaming App) your custom login menu should not allow changing the login nor logging out. You can check if the user has logged in externally using TGASDK.TGA.LoggedInExternally(). It is recommended you still have the UI to show the class and student ids. This can be the same UI you use to login inside the game just having the input fields and buttons in a disabled state disabled for example.</p>

<p>If you choose to create your own login menu you need to pass the class id and student id to the auth process. From a Monobehaviour script you need to run a coroutine with the code on the right.</p>

<p>You can also listen to the TGASDK.TGA.OnLoginStatusChanged event to get notified when the login status changes.</p>

<h2 id="sending-events">Sending events</h2>

<p>The events that have been defined in TeacherGaming Desk website are generated to the SDK and can be used to send data from the game to Desk. All the events have their own inner class inside TGA&lt;yourgamename&gt;.Event with a property for each event parameter and functions to start and send the event.</p>

<h3 id="sending-events-with-duration">Sending events with duration</h3>
<pre class="highlight csharp tab-csharp"><code><span class="c1">// This is an example with our game Switch N’ Glitch.</span>

<span class="c1">/// When the player enters a singleplayer level, in our StartGame() function </span>
<span class="n">TGASDKSwitchGlitch</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">SPLevelComplete</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span> 

<span class="c1">// And when the player has completed the level:</span>
<span class="n">TGASDKSwitchGlitch</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">SPLevelComplete</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">LevelId</span> <span class="p">=</span> <span class="n">Client</span><span class="p">.</span><span class="n">UIActiveClient</span><span class="p">.</span><span class="n">LocalGame</span><span class="p">.</span><span class="n">GameBoard</span><span class="p">.</span><span class="n">PrefabPath</span><span class="p">;</span>
<span class="n">TGASDKSwitchGlitch</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">SPLevelComplete</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">FailedCommandCount</span> <span class="p">=</span> <span class="n">player</span><span class="p">.</span><span class="n">failedTileCount</span><span class="p">;</span>
<span class="n">TGASDKSwitchGlitch</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">SPLevelComplete</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">CommitCount</span> <span class="p">=</span> <span class="n">player</span><span class="p">.</span><span class="n">totalCommitCount</span><span class="p">;</span>
<span class="n">TGASDKSwitchGlitch</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">SPLevelComplete</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">OptimalCommitsForLevel</span> <span class="p">=</span> <span class="n">Client</span><span class="p">.</span><span class="n">UIActiveClient</span><span class="p">.</span><span class="n">LocalGame</span><span class="p">.</span><span class="n">GameBoard</span><span class="p">.</span><span class="n">programExecutionsGoal</span><span class="p">;</span>
<span class="n">TGASDKSwitchGlitch</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">SPLevelComplete</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">MetagelCollected</span> <span class="p">=</span> <span class="n">player</span><span class="p">.</span><span class="n">playerScore</span><span class="p">;</span>
<span class="n">TGASDKSwitchGlitch</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">SPLevelComplete</span><span class="p">.</span><span class="nf">Send</span><span class="p">();</span>
</code></pre>
<p>This is useful for events that have a clear start and end times and as such a duration. Our SDK can automatically count time from beginning to end and append duration to sent data. You can also modify any additional data inside the event before you send it.
To start an event, call TGASDK.Event.<EventName>.Start()
You can change additional data inside the event before you send it. All data for the started event can be changed using TGASDK.Event.<EventName>.Current.<ParameterName>
To send the event, call TGASDK.Event.<EventName>.Send() without parameters.</p>

<h3 id="sending-events-without-duration">Sending events without duration</h3>
<pre class="highlight csharp tab-csharp"><code><span class="c1">// Sending an event without duration</span>

<span class="c1">// This example is from KerbalEdu</span>
<span class="n">TGASDKKerbalEdu</span><span class="p">.</span><span class="n">Event</span><span class="p">.</span><span class="n">SituationChange</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="n">FlightGlobals</span><span class="p">.</span><span class="n">ActiveVessel</span><span class="p">.</span><span class="n">mainBody</span><span class="p">.</span><span class="n">bodyName</span><span class="p">,</span> <span class="n">FlightGlobals</span><span class="p">.</span><span class="n">ActiveVessel</span><span class="p">.</span><span class="n">situation</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(),</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">FlightGlobals</span><span class="p">.</span><span class="n">ActiveVessel</span><span class="p">.</span><span class="n">totalMass</span><span class="p">);</span>
</code></pre>
<p>You can call TGASDK.Event.<EventName>.Send(&hellip;) with event data as parameters to send an event immediately, without tracking for duration.</p>

<h2 id="updating-state">Updating state</h2>

<p>Updating state can be done using one of three function calls</p>

<ul>
<li>TGASDK.TGA.UpdateUserState(string state)

<ul>
<li>This sets the state showing below student name in teacher dashboard. It also resets detailed state showing below this state, if there was any.</li>
</ul></li>
<li>TGASDK.TGA.UpdateUserState(string state, string detailedState)

<ul>
<li>This sets the state showing below student name in teacher dashboard and detailed state below it.</li>
</ul></li>
<li>TGASDK.TGA.UpdateUserStateDetailedOnly(string stateDetailed)

<ul>
<li>This sets the detailed state below main state and does not reset the main state. You can use this to for ex. Update round numbers or other live data happening in current state of your game.</li>
</ul></li>
</ul>

<p>You can keep the state update calls in your game and don’t need to check if user is logged in to TGA, we will automatically check inside the function calls if player is currently authenticated to TGA and send the state update only if so.</p>

<h3 id="state-examples">State examples</h3>
<pre class="highlight csharp tab-csharp"><code><span class="n">TGASDK</span><span class="p">.</span><span class="n">TGA</span><span class="p">.</span><span class="nf">UpdateUserState</span><span class="p">(</span><span class="s">"In Main Menu"</span><span class="p">);</span>
</code></pre><pre class="highlight csharp tab-csharp"><code><span class="n">TGASDK</span><span class="p">.</span><span class="n">TGA</span><span class="p">.</span><span class="nf">UpdateUserState</span><span class="p">(</span><span class="s">"In Settings Menu"</span><span class="p">);</span>
</code></pre><pre class="highlight csharp tab-csharp"><code><span class="n">TGASDK</span><span class="p">.</span><span class="n">TGA</span><span class="p">.</span><span class="nf">UpdateUserState</span><span class="p">(</span><span class="s">"Playing Singleplayer Game"</span><span class="p">,</span> <span class="s">"Tutorial Level 4"</span><span class="p">);</span>
</code></pre><pre class="highlight csharp tab-csharp"><code><span class="c1">// When game begun</span>
<span class="n">TGASDK</span><span class="p">.</span><span class="n">TGA</span><span class="p">.</span><span class="nf">UpdateUserState</span><span class="p">(</span><span class="s">"Playing Multiplayer Game"</span><span class="p">);</span>
<span class="c1">// When round changed</span>
<span class="n">TGASDK</span><span class="p">.</span><span class="n">TGA</span><span class="p">.</span><span class="nf">UpdateUserStateDetailedOnly</span><span class="p">(</span><span class="s">"Round 2"</span><span class="p">);</span>
</code></pre>
<table>
<tr>
    <td width="20%"> <img src="images/integrations/unitycsharp/image5.png"/> </td>
    <td width="20%"> <img src="images/integrations/unitycsharp/image4.png"/> </td>
    <td width="20%"> <img src="images/integrations/unitycsharp/image2.png"/> </td>
    <td width="20%"> <img src="images/integrations/unitycsharp/image1.png"/> </td>
    <td width="20%"> <img src="images/integrations/unitycsharp/image3.png"/> </td>
</tr>
<tr>
    <td><small>Default state for logged-in student </small></td>
    <td><small>Student is in main menu </small></td>
    <td><small>Student is in settings menu</small></td>
    <td><small>Student is playing singleplayer game, Tutorial Level 4 has been passed for detailed state</small></td>
    <td><small>Student is playing multiplayer game, Round number is being passed to detailed state when round changes</small></td>
</tr>
</table>

<h2 id="creatubbles">Creatubbles</h2>

<p>Creatubbles integration can be used to take a screenshot of the game and send it to TGA and Creatubbles web page. To use this feature the user needs to be logged in to TGA and the CreatubblesManager script needs to be attached to a gameobject as explained in the FIRST STEPS section.</p>

<h3 id="usage">Usage</h3>
<pre class="highlight csharp tab-csharp"><code><span class="c1">/// Creatubbles</span>
<span class="n">TGASDK</span><span class="p">.</span><span class="n">TGA</span><span class="p">.</span><span class="nf">ScreenShotToCreatubbles</span><span class="p">();</span>
</code></pre>
<p>To send a screenshot to TGA you can simply call TGASDK.TGA.ScreenShotToCreatubbles(). This will take a screenshot and open a UI that shows you the image that would be sent and where you can enter a description for the screenshot.
<img src="/images/integrations/unitycsharp/image7.png" title="Creatubbles UI" alt="Creatubbles UI" /></p>

<p>For example you can create a simple button to send the screenshot and show it in your in-game UI. There is a camera texture in the “TGA/Resources/Graphics/” folder that you can use with the button if you wish.</p>

<h2 id="getting-information">Getting information</h2>

<h3 id="general-information">General information</h3>
<pre class="highlight csharp tab-csharp"><code><span class="c1">// General information</span>

<span class="c1">// Call example: TGASDK.TGA.IsUserLoggedIn()</span>

<span class="c1">// Login information</span>

<span class="c1">// Returns true if logged into TGA, otherwise false.</span>
<span class="kt">bool</span> <span class="nf">IsUserLoggedIn</span><span class="p">()</span>

<span class="c1">// Returns true if logged into TGA via broadcast (TGA App), otherwise false.</span>
<span class="kt">bool</span> <span class="nf">LoggedInExternally</span><span class="p">()</span>

<span class="c1">// Returns the student ID used for login.</span>
<span class="kt">string</span> <span class="nf">GetStudentId</span><span class="p">()</span>

<span class="c1">// Returns the class ID used for login.</span>
<span class="kt">string</span> <span class="nf">GetClassId</span><span class="p">()</span>
</code></pre>
<p>Here (on the right) are some functions you can use to get status information about TGA. All of these are static functions of TGASDK.TGA.</p>

<h3 id="subscription-information">Subscription information</h3>
<pre class="highlight csharp tab-csharp"><code><span class="c1">// Subscription information</span>

<span class="c1">// Returns true if game subscription has expired, otherwise false.</span>
<span class="kt">bool</span> <span class="nf">SubscriptionExpired</span><span class="p">()</span>

<span class="c1">// Returns the message that should be shown to user if the subscription has expired</span>
<span class="kt">string</span> <span class="nf">SubscriptionExpiredMessage</span><span class="p">()</span>
</code></pre>
<p>These functions can be used to query if there is a valid subscription for the game. For testing the subscription, there are these two classes: Class h1xme never has subscription expired. Class h1xjr always has subscription expired. Both of these classes have student self-signup enabled so user can login with any studentid for testing.</p>
